name: Constitutional Enforcement

on:
  push:
    branches: ['**']
  pull_request:
    branches: ['**']

jobs:
  constitutional-gates:
    name: Constitutional Gates
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      # GATE 1: DEPENDENCY LAW
      - name: 'GATE 1: Dependency Preflight'
        run: npm run gatekeeper:dependencies

      # GATE 2: INSTALL
      - name: 'GATE 2: Install Dependencies'
        run: npm ci

      # GATE 3: IMMUTABILITY ENFORCEMENT
      - name: 'GATE 3: Immutability Check'
        run: npm run gatekeeper:immutability

      # GATE 4: TOKEN BYPASS ELIMINATION
      - name: 'GATE 4: AST Validation (Tailwind Literals)'
        run: npm run gatekeeper:ast

      # GATE 5: TYPE ABSOLUTISM
      - name: 'GATE 5: Constitutional Lint'
        run: npm run lint:constitutional

      # GATE 6: INVARIANT VALIDATION
      - name: 'GATE 6: Validate Invariants'
        run: npm run validate:invariants

      # GATE 7: BUILD
      - name: 'GATE 7: Build'
        run: npm run build

      # FINAL GATE: SUCCESS
      - name: 'CONSTITUTIONAL ENFORCEMENT: PASSED'
        run: |
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo "  CONSTITUTIONAL ENFORCEMENT COMPLETE"
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo ""
          echo "✓ Dependency Law Enforced"
          echo "✓ Immutability Preserved"
          echo "✓ Token Bypass Eliminated"
          echo "✓ Type Absolutism Maintained"
          echo "✓ Invariants Validated"
          echo "✓ Build Successful"
          echo ""
          echo "The system enforces itself."
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
